#!/bin/bash
# Praxis Launch Script - Simple wrapper for virtual environment management

# Get the directory where this script is located
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Ensure we have a virtual environment and activate it
if [ ! -d "$SCRIPT_DIR/.venv" ]; then
    echo "Creating virtual environment..."
    python3 -m venv "$SCRIPT_DIR/.venv"
fi

echo "[SYSTEM] Activated virtual environment."

# Always activate the venv (we'll deactivate at the end)
. "$SCRIPT_DIR/.venv/bin/activate"

# Install praxis package if not already installed
# The pyproject.toml should always exist in the project root
if [ -f "$SCRIPT_DIR/pyproject.toml" ]; then
    # Quick check if praxis is installed
    if ! python -c "import praxis" 2>/dev/null; then
        echo "[ENV] Installing Praxis in development mode..."
        pip install -e "$SCRIPT_DIR"
        echo "[ENV] Praxis installation complete"
    else
        echo "[ENV] Praxis is installed."
    fi
fi

# Pass all arguments directly to main.py
python "$SCRIPT_DIR/main.py" "$@"
EXIT_CODE=$?

# Deactivate the virtual environment and exit with the command's exit code
deactivate
exit $EXIT_CODE