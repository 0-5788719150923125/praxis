# Eidolon - Binary Classification Pipeline Configuration

# Model configuration
model:
  name: "facebook/deit-small-patch16-224"
  num_classes: 2
  image_size: 224

# Frame extraction settings
extraction:
  fps: 5 # Sample rate (frames per second to extract)
  quality: 95 # JPEG quality (1-100)

# Training configuration
training:
  batch_size: 8
  learning_rate: 0.001
  epochs: 50
  early_stopping_patience: 10
  weight_decay: 0.1
  warmup_steps: 10
  train_split: 0.70
  val_split: 0.15
  test_split: 0.15
  use_class_weights: false # deprecated - now using Focal Loss

  # Focal Loss configuration
  focal_alpha: 1.0 # Class weighting factor (1.0 = balanced)
  focal_gamma: 2.0 # Focusing parameter: higher = more focus on hard examples (typical: 2.0-5.0)

  # PEFT (Parameter-Efficient Fine-Tuning) configuration
  use_peft: true
  peft:
    r: 4
    lora_alpha: 8
    lora_dropout: 0.1
    # Target modules: must match actual layer names in the model
    # For DeiT/ViT: ["query", "value"] or ["query", "key", "value"]
    # Run training once to see "Available linear layers" list
    target_modules: ["key", "query", "value"]
    bias: "lora_only"

# Inference configuration
inference:
  use_gpu: true
  batch_size: 256 # Larger batch = faster inference
  threshold: 0.5 # Classification threshold (lower = more detections)
  min_event_duration: 0.4 # Minimum duration in seconds (filters brief detections)

# MLT project generation
mlt:
  marker_buffer: 1.0 # seconds before prediction to place timeline cut/marker
  post_buffer: 2.0 # seconds after event end (for extract mode)
  mute_audio: true # Mute source video audio (allows adding music separately)
  add_benny_hill: false # Add Benny Hill theme song (59s max with 3s fade-out)
  vertical_format: false # Use vertical 1080x1920 format with zoom (for mobile/TikTok/Shorts)

# Paths
paths:
  videos: "videos"
  frames: "data/frames"
  labels: "data/labels.csv"
  dataset: "data/dataset"
  models: "models"
  predictions: "outputs/predictions"
  events: "outputs/events"
  mlt_projects: "outputs/projects"
